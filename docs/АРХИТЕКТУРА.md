АРХИТЕКТУРА ПРОЕКТА "HTTP PROXY COURSE"
===========================================

Общее описание
---------------
Десктоп-приложение для обучения, реализованное на C++17 и фреймворке Qt 6.
Система предоставляет интерфейсы для двух ролей ("Студент", "Администратор")
и использует гибридную модель хранения данных:
- **PostgreSQL:** Динамические данные (учетные записи, прогресс обучения).
- **Зашифрованный бинарный файл (`course.bin`):** Статический контент курса
  (главы, тесты).

Ключевые архитектурные принципы
-------------------------------------
Гибридное хранилище
    Разделение данных для обеспечения безопасности контента (файл) и
    надежности хранения пользовательских данных (БД).
Programmatic UI
    Пользовательский интерфейс создается исключительно кодом C++.
    Использование `.ui` файлов (Qt Designer) запрещено.
Централизованная конфигурация
    Ключевые параметры (ключ шифрования, путь к файлу курса) вынесены
    в пространство имен `AppSettings` для обеспечения единого источника
    истины и упрощения поддержки.
Идемпотентная инициализация
    При первом запуске система автоматически создает структуру БД,
    пользователя `admin` и файл `course.bin`, что обеспечивает
    самодостаточность и простоту развертывания.

Поток данных курса (Content Pipeline)
-------------------------------------------
1.  **Источник:** Исходный контент находится в ресурсах приложения
    (`:/course.json`).
2.  **Инициализация:** При первом запуске `CourseManager` парсит JSON-ресурс.
3.  **Сериализация и шифрование:** Объект `Course` сериализуется в `QByteArray`
    и шифруется с помощью `CryptoUtils::xorEncryptDecrypt`.
4.  **Хранение:** Зашифрованные данные сохраняются в `course.bin` по пути,
    полученному из `AppSettings::getCourseBinaryPath()`.
5.  **Загрузка:** При последующих запусках `CourseManager` читает `course.bin`,
    расшифровывает данные и десериализует их в объект `Course` для
    использования в UI.

Компонентная структура
---------------------------

### Модели данных (`src/models/`)

`Structures.h`
    Содержит структуры `Question`, `Chapter`, `Course`. Отвечают за
    представление данных в памяти и предоставляют операторы для бинарной
    сериализации/десериализации (`QDataStream`).

### Ядро системы (`src/core/`)

`CourseManager` (статический класс)
    Оркестрирует жизненный цикл контента курса. Отвечает за парсинг JSON,
    сериализацию/десериализацию и взаимодействие с файловой системой.
`CryptoUtils` (статический класс)
    Предоставляет чистые функции для криптографических операций:
    симметричное XOR-шифрование и хэширование паролей (SHA-256).
`AppSettings` (namespace)
    Хранит глобальные константы и предоставляет унифицированный метод
    `getCourseBinaryPath()` для доступа к файлу курса.

### Управление БД (`src/db/`)

`DatabaseManager` (Singleton)
    Предоставляет централизованный интерфейс для взаимодействия с PostgreSQL.
    Управляет подключением, инициализацией схемы (включая создание
    `admin` по умолчанию), регистрацией, аутентификацией и сохранением
    прогресса.

### Пользовательский интерфейс (`src/ui/`)

`LoginDialog`
    Модальный диалог для аутентификации и регистрации. Использует
    `DatabaseManager` для проверки данных.
`AdminWindow`
    Главное окно администратора. Загружает список пользователей из
    `DatabaseManager` и данные курса из `CourseManager`. Позволяет
    редактировать курс (сохраняя через `CourseManager`) и генерировать
    отчеты.
`StudentWindow`
    Главное окно студента. Загружает курс через `CourseManager`.
    Считывает и сохраняет прогресс через `DatabaseManager`. Реализует
    логику обучения и тестирования.

Взаимодействие компонентов
------------------------------
Запуск (`main.cpp`)
    1. Инициализирует `DatabaseManager` (подключение, создание схемы и
       пользователя `admin`).
    2. Вызывает `initializeCourse()`, которая через `CourseManager` и
       `AppSettings` обеспечивает наличие `course.bin`.
    3. Запускает `LoginDialog`.
    4. После успешного входа создает экземпляр `AdminWindow` или
       `StudentWindow`.

Аутентификация
    `LoginDialog` -> `CryptoUtils::hashPassword` (хэширует введенный пароль)
    -> `DatabaseManager::authenticateUserWithId` (сверяет с хэшем в БД).

Редактирование курса (Admin)
    `AdminWindow` (UI) -> `CourseManager::saveCourseToBinary` (сериализация)
    -> `CryptoUtils::xorEncryptDecrypt` (шифрование) -> Файл `course.bin`.

Прохождение теста (Student)
    `StudentWindow` (UI) -> `DatabaseManager::saveProgress` (сохраняет
    результат: "completed" или "fail").

Технологии и форматы
------------------------
- **Язык:** C++17
- **Фреймворк:** Qt 6 (Core, GUI, Widgets, SQL)
- **СУБД:** PostgreSQL
- **Формат источника:** JSON
- **Формат хранения:** Кастомный бинарный формат с "магическим числом"
  для верификации.
- **Шифрование:** Симметричный алгоритм XOR.
- **Хэширование:** SHA-256.
